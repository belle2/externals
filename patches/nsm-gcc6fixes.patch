From 5a48d60849ef7c7927cec749843d0d6f9ead5e36 Mon Sep 17 00:00:00 2001
From: Martin Ritter <martin.ritter@desy.de>
Date: Wed, 28 Sep 2016 15:43:57 +0200
Subject: [PATCH 1/3] Fix installation if target dir already exists

---
 corelib/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/corelib/Makefile b/corelib/Makefile
index 33fea03..b5f87d6 100644
--- a/corelib/Makefile
+++ b/corelib/Makefile
@@ -26,7 +26,7 @@ libs::
 install::
 	install libnsm2_corelib.a $(EXTLIBDIR)
 	install libnsm2_corelib.so $(EXTLIBDIR)
-	mkdir $(EXTINCDIR)/nsm2
+	mkdir -p $(EXTINCDIR)/nsm2
 	install nsmlib2.h $(EXTINCDIR)/nsm2
 	install nsmparse.h $(EXTINCDIR)/nsm2
 
-- 
2.9.0


From 41a4bb774197b49543ce9a955e9bff42c8d4a2cf Mon Sep 17 00:00:00 2001
From: Martin Ritter <martin.ritter@desy.de>
Date: Wed, 28 Sep 2016 15:44:19 +0200
Subject: [PATCH 2/3] Make make exit on errors

---
 Makefile | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/Makefile b/Makefile
index 9b03572..353afe6 100644
--- a/Makefile
+++ b/Makefile
@@ -6,14 +6,14 @@ SUBDIRS = corelib b2lib daemon
 
 all::
 	for subdir in $(SUBDIRS); do \
-	  cd $$subdir; make; cd .. ; \
+	  cd $$subdir && make && cd .. || exit 1; \
 	done
 install::
 	for subdir in $(SUBDIRS); do \
-	  cd $$subdir; make install; cd .. ; \
+	  cd $$subdir && make install && cd .. || exit 1; \
 	done
 
 clean::
 	for subdir in $(SUBDIRS); do \
-	  cd $$subdir; make clean; cd .. ; \
+	  cd $$subdir && make clean && cd .. || exit 1; \
 	done
-- 
2.9.0


From f42fe913ad80c365316bf0b10d7a571d2ee3ae93 Mon Sep 17 00:00:00 2001
From: Martin Ritter <martin.ritter@desy.de>
Date: Wed, 28 Sep 2016 15:44:34 +0200
Subject: [PATCH 3/3] Fix compilation issues on gcc6.2

---
 daemon/nsmd2.cc | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/daemon/nsmd2.cc b/daemon/nsmd2.cc
index 7d4468a..62a477d 100644
--- a/daemon/nsmd2.cc
+++ b/daemon/nsmd2.cc
@@ -41,6 +41,7 @@
 #include <stdlib.h>
 #include <unistd.h>
 #include <ctype.h>
+#include <cmath>
 #include <string.h>
 #include <time.h>
 #include <fcntl.h>
@@ -3626,7 +3627,7 @@ nsmd_do_newmaster(NSMcon& con, NSMdmsg& dmsg)
   if (tim != sys.con[NSMCON_TCP].timstart) {
     ASRT("do_newmaster: wrong tim=%lx/%lx", tim, sys.con[NSMCON_TCP].timstart);
   }
-  if (abs(dmsg.pars[8] - sys.generation) > 1) {
+  if (std::abs(dmsg.pars[8] - sys.generation) > 1) {
     ASRT("do_newmaster: generation leap=%d/%d", sys.generation, dmsg.pars[8]);
   }
   sys.generation = dmsg.pars[8];
@@ -3771,7 +3772,7 @@ nsmd_do_newmaster_old_and_buggy(NSMcon& con, NSMdmsg& dmsg)
   if (tim != sys.con[NSMCON_TCP].timstart) {
     ASRT("do_newmaster: wrong tim=%lx/%lx", tim, sys.con[NSMCON_TCP].timstart);
   }
-  if (abs(dmsg.pars[8] - sys.generation) > 1) {
+  if (std::abs(dmsg.pars[8] - sys.generation) > 1) {
     ASRT("do_newmaster: generation leap=%d/%d", sys.generation, dmsg.pars[8]);
   }
   sys.generation = dmsg.pars[8];
-- 
2.9.0

